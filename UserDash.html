<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoSafar â€¢ User Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
    --green-dark:#0b3d0f;
    --green-main:#145A13;
    --green-light:#dafae9;
    --accent:#2ecc71;
    --bg:#f4fbf7;
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:Inter,sans-serif;
}

body{
    background:linear-gradient(145deg,#eef9f1,#e3f5ea);
    color:#1b3a2d;
    min-height:100vh;
}

/* TOP BAR */
.topbar{
    background:#d6f5d6;
    padding:16px 32px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 6px 20px rgba(0,0,0,0.12);
    position:sticky;
    top:0;
    z-index:10;
}

.topbar h2{
    font-weight:700;
    color:var(--green-dark);
}

.btn{
    padding:10px 22px;
    background:white;
    border:none;
    border-radius:12px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
    transition:0.3s;
}
.btn:hover{
    background:var(--green-light);
    transform:translateY(-2px);
}

/* LAYOUT */
.container{
    max-width:1200px;
    margin:auto;
    padding:36px 28px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
    gap:32px;
}

/* CARDS */
.card{
    background:rgba(255,255,255,0.96);
    border-radius:22px;
    padding:32px;
    box-shadow:
        0 12px 30px rgba(0,0,0,0.1),
        0 4px 10px rgba(0,0,0,0.05);
    transition:0.3s;
}
.card:hover{
    transform:translateY(-6px);
    box-shadow:
        0 20px 50px rgba(0,0,0,0.15);
}

.card h3{
    font-size:1.6rem;
    margin-bottom:20px;
    color:var(--green-main);
}

/* STATS */
.big{
    font-size:52px;
    font-weight:700;
    color:var(--accent);
    margin-bottom:12px;
}

.stat-line{
    margin-top:6px;
    font-size:15px;
}

.level{
    display:inline-block;
    margin-top:10px;
    padding:6px 16px;
    background:var(--green-main);
    color:white;
    border-radius:16px;
    font-weight:600;
    font-size:0.95rem;
}

/* TABLE */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:16px;
    font-size:14px;
    overflow:hidden;
    border-radius:14px;
}

thead{
    background:var(--green-main);
    color:white;
}

th,td{
    padding:12px 12px;
    text-align:left;
}

tbody tr{
    transition:0.2s;
}
tbody tr:hover{
    background:var(--green-light);
}

/* FOOT NOTE */
.note{
    margin-top:16px;
    font-size:13px;
    background:#e5fff3;
    border-left:5px solid var(--green-main);
    padding:12px 14px;
    border-radius:12px;
}
</style>
</head>

<body>

<header class="topbar">
    <h2 id="username">User</h2>
    <button class="btn" onclick="location.href='index.html'">Home</button>
</header>

<main class="container">

    <!-- STATS CARD -->
    <section class="card">
        <h3>Your Eco Impact</h3>

        <div id="points" class="big">0</div>

        <div class="stat-line">
            Total Waste Added: <strong id="weight">0 g</strong>
        </div>

        <div class="stat-line">
            Level:
            <span id="level" class="level">Bronze</span>
        </div>

        <div class="note">
            Points are awarded automatically when you dispose waste using the smart bin.
        </div>
    </section>

    <!-- HISTORY CARD -->
    <section class="card">
        <h3>Disposal History</h3>

        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Weight (g)</th>
                    <th>Eco Points</th>
                </tr>
            </thead>
            <tbody id="history"></tbody>
        </table>
    </section>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  authDomain: "ecosafar-b8e9b.firebaseapp.com",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com",
  projectId: "ecosafar-b8e9b",
  storageBucket: "ecosafar-b8e9b.firebasestorage.app",
  messagingSenderId: "277553134320",
  appId: "1:277553134320:web:efd3d87dab7d925825a035"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");

if(!uid){
    alert("No UID provided");
    throw new Error("UID missing");
}

const userRef = ref(db,"users/"+uid);

onValue(userRef,(snapshot)=>{
    if(!snapshot.exists()) return;

    const d = snapshot.val();

    document.getElementById("username").innerText = d.name;
    document.getElementById("points").innerText = d.points || 0;
    document.getElementById("weight").innerText = (d.totalWeight || 0) + " g";
    document.getElementById("level").innerText = getLevel(d.points || 0);

    const tbody = document.getElementById("history");
    tbody.innerHTML = "";

    if(d.history){
        Object.values(d.history).reverse().forEach(h=>{
            tbody.innerHTML += `
                <tr>
                    <td>${h.date}</td>
                    <td>${h.weight}</td>
                    <td>${h.points}</td>
                </tr>`;
        });
    }
});

function getLevel(p){
    if(p>=1000) return "Platinum";
    if(p>=500) return "Gold";
    if(p>=200) return "Silver";
    return "Bronze";
}
</script>

</body>
</html>
