<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EcoSafar â€¢ User Dashboard</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
      background: #eef5f0;
      color: #222;
    }

    .topbar {
      background: #00a86b;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand h1 {
      font-size: 20px;
      margin: 0;
    }

    .logo-xs {
      height: 32px;
    }

    .btn {
      padding: 8px 14px;
      background: white;
      color: #00a86b;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    .container-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 5px 18px rgba(0,0,0,0.12);
    }

    .card h3 {
      margin-top: 0;
      color: #007347;
    }

    .big-number {
      font-size: 36px;
      font-weight: bold;
      color: #00a86b;
      margin-bottom: 10px;
    }

    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      color: #222;
    }

    thead {
      background: #00a86b;
      color: white;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ccc;
      font-size: 14px;
    }

    tr:hover {
      background: #f4fdf8;
    }

    /* Message Box */
    .info-box {
      margin-top: 15px;
      padding: 12px;
      background: #e8fff1;
      border-left: 4px solid #00a86b;
      border-radius: 6px;
      color: #005c37;
      font-size: 14px;
    }
  </style>
</head>

<body>

  <header class="topbar">
    <div class="brand">
      <img src="logo.svg" class="logo-xs" alt="">
      <h1>EcoSafar</h1>
    </div>
    <button class="btn" onclick="location.href='index.html'">Home</button>
  </header>

  <main class="container-grid">

    <!-- Stats Card -->
    <section class="card stats">
      <h3>Your Eco Points</h3>
      <div id="points" class="big-number">0</div>
      <p>Total Waste Added: <strong id="totalWeight">0 g</strong></p>
      <p>Your Level: <span id="level">Bronze</span></p>

      <div class="info-box">
        Points and history are updated automatically by the smart bin.
      </div>
    </section>

    <!-- History Card -->
    <section class="card history">
      <h3>Disposal History</h3>
      <table id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Weight (g)</th>
            <th>Points Earned</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

  </main>

  <script>
    const params = new URLSearchParams(location.search);
    const username = params.get('username') || 'user01';
    const storageKey = 'ecosafar_demo_' + username;

    // Demo stored data (ESP32 would override this in real system)
    let user = JSON.parse(localStorage.getItem(storageKey)) || {
      points: 195,
      totalWeight: 2100,
      history: [
        {date:'2025-12-07',weight:500,points:50},
        {date:'2025-12-07',weight:250,points:25},
        {date:'2025-12-05',weight:500,points:35},
        {date:'2025-12-03',weight:350,points:35},
        {date:'2025-12-01',weight:500,points:50}
      ]
    };

    function render(){
      document.getElementById('points').innerText = user.points;
      document.getElementById('totalWeight').innerText = user.totalWeight + ' g';
      document.getElementById('level').innerText = getLevel(user.points);

      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';

      user.history.slice().reverse().forEach(h => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${h.date}</td><td>${h.weight}</td><td>${h.points}</td>`;
        tbody.appendChild(tr);
      });

      localStorage.setItem(storageKey, JSON.stringify(user));
    }

    function getLevel(points){
      if(points >= 1000) return 'Platinum';
      if(points >= 500) return 'Gold';
      if(points >= 200) return 'Silver';
      return 'Bronze';
    }

    render();
  </script>

</body>
</html>
