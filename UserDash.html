<!DOCTYPE html>
<html>
<head>
  <title>User Dashboard</title>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body { font-family: Arial; }
    table { width: 100%; border-collapse: collapse; }
    td,th { border:1px solid #000; padding:8px; text-align:center; }
  </style>
</head>
<body>

<h2>EcoSafar â€“ User Dashboard</h2>

<p><b>UID:</b> <span id="uid"></span></p>
<p><b>Name:</b> <span id="name"></span></p>
<p><b>Total Weight:</b> <span id="weight"></span> g</p>
<p><b>EcoPoints:</b> <span id="points"></span></p>
<p><b>Money:</b> â‚¹<span id="money"></span></p>

<h3>Transaction History</h3>
<div id="history"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com",
  projectId: "ecosafar-b8e9b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let uid = localStorage.getItem("uid");
if(!uid){
  alert("Login first");
  window.location.href = "index.html";
}

document.getElementById("uid").innerText = uid;

// ðŸ”¥ REAL TIME USER DATA
db.ref("users/" + uid).on("value", snap=>{
  const d = snap.val();
  if(!d) return;

  document.getElementById("name").innerText = d.name || "User";
  document.getElementById("weight").innerText = d.TotalWeight || 0;
  document.getElementById("points").innerText = d.Ecopoints || 0;
  document.getElementById("money").innerText =
    ((d.TotalWeight || 0) / 100 * 10).toFixed(2);
});

// ðŸ”¥ REAL TIME HISTORY
db.ref("history/" + uid).limitToLast(10).on("value", snap=>{
  if(!snap.exists()){
    document.getElementById("history").innerHTML = "No History";
    return;
  }

  let html = `<table>
    <tr><th>#</th><th>Weight (g)</th><th>EcoPoints</th></tr>`;

  let i = 1;
  snap.forEach(s=>{
    html += `
      <tr>
        <td>${i++}</td>
        <td>${s.val().weight}</td>
        <td>${s.val().points}</td>
      </tr>`;
  });

  html += "</table>";
  document.getElementById("history").innerHTML = html;
});
</script>

</body>
</html>