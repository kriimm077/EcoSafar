<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoSafar â€¢ Admin Dashboard</title>

<!-- Firebase v8 (compatible & stable) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#eef9f1;
  padding:20px;
}

h2{
  color:#145A13;
  margin-bottom:20px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#ffffff;
}

th, td{
  padding:10px;
  border:1px solid #ccc;
  text-align:center;
}

th{
  background:#dff3ea;
  color:#145A13;
}

tr:nth-child(even){
  background:#f5fbf7;
}
</style>
</head>

<body>

<h2>EcoSafar â€“ Admin Dashboard</h2>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>RFID UID</th>
      <th>Name</th>
      <th>City</th>
      <th>Total Waste (g)</th>
      <th>EcoPoints</th>
    </tr>
  </thead>
  <tbody id="users">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>

<script>
/* =========================
   FIREBASE INITIALIZATION
========================= */
firebase.initializeApp({
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com",
  projectId: "ecosafar-b8e9b"
});

const db = firebase.database();

/* =========================
   LOAD ALL USERS (REAL-TIME)
========================= */
db.ref("users").on("value", snapshot => {

  let users = [];

  snapshot.forEach(child => {
    const uid  = child.key;
    const data = child.val();

    // Skip invalid user records
    if (!data || !data.name) return;

    users.push({
      uid: uid,
      name: data.name || "-",
      city: data.city || "-",
      TotalWeight: Number(data.TotalWeight || 0),
      Ecopoints: Number(data.Ecopoints || 0)
    });
  });

  // ðŸ† Sort by EcoPoints (DESC)
  users.sort((a, b) => b.Ecopoints - a.Ecopoints);

  let html = "";

  users.forEach((user, index) => {
    html += `
      <tr>
        <td>${index + 1}</td>
        <td>${user.uid}</td>
        <td>${user.name}</td>
        <td>${user.city}</td>
        <td>${user.TotalWeight.toFixed(2)}</td>
        <td>${user.Ecopoints.toFixed(2)}</td>
      </tr>
    `;
  });

  document.getElementById("users").innerHTML =
    html || "<tr><td colspan='6'>No users found</td></tr>";
});
</script>

</body>
</html>
