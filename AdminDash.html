<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoSafar â€¢ Admin Dashboard</title>

<!-- Firebase v8 (compatible & stable) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
/* ====== BODY & TYPOGRAPHY ====== */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0faf5;
  margin: 0;
  padding: 30px 20px;
  color: #145A13;
  text-align: center;
}

/* ====== LOGO ANIMATION ====== */
#logo {
  width: 100px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%   { transform: translateY(0px) rotate(0deg); }
  25%  { transform: translateY(-10px) rotate(-3deg); }
  50%  { transform: translateY(0px) rotate(0deg); }
  75%  { transform: translateY(-10px) rotate(3deg); }
  100% { transform: translateY(0px) rotate(0deg); }
}

/* ====== HEADING ====== */
h2 {
  color: #145A13;
  font-weight: 600;
  font-size: 28px;
  margin-bottom: 25px;
  letter-spacing: 0.5px;
}

/* ====== TABLE STYLING ====== */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: #ffffff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

th, td {
  padding: 14px 12px;
  text-align: center;
  font-size: 15px;
}

th {
  background: #dff3ea;
  color: #145A13;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

td {
  color: #2c3e2f;
}

tr:nth-child(even) td {
  background: #f7fcf8;
}

tr:hover td {
  background: #e3f5df;
  transition: 0.2s;
}

/* ====== RESPONSIVE ====== */
@media (max-width: 768px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }
  thead tr {
    display: none;
  }
  tr {
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    overflow: hidden;
  }
  td {
    text-align: right;
    padding-left: 50%;
    position: relative;
  }
  td::before {
    content: attr(data-label);
    position: absolute;
    left: 15px;
    width: calc(50% - 30px);
    font-weight: 600;
    text-align: left;
    color: #145A13;
  }
}
</style>
</head>

<body>

<!-- Logo with cute animation -->
<img src="logo.png" id="logo" alt="EcoSafar Logo">

<h2>EcoSafar â€“ Admin Dashboard</h2>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>RFID UID</th>
      <th>Name</th>
      <th>City</th>
      <th>Total Waste (g)</th>
      <th>EcoPoints</th>
    </tr>
  </thead>
  <tbody id="users">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>

<script>
/* =========================
   FIREBASE INITIALIZATION
========================= */
firebase.initializeApp({
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com",
  projectId: "ecosafar-b8e9b"
});

const db = firebase.database();

/* =========================
   LOAD ALL USERS (REAL-TIME)
========================= */
db.ref("users").on("value", snapshot => {

  let users = [];

  snapshot.forEach(child => {
    const uid  = child.key;
    const data = child.val();

    // Skip invalid user records
    if (!data || !data.name) return;

    users.push({
      uid: uid,
      name: data.name || "-",
      city: data.city || "-",
      TotalWeight: Number(data.TotalWeight || 0),
      Ecopoints: Number(data.Ecopoints || 0)
    });
  });

  // ðŸ† Sort by EcoPoints (DESC)
  users.sort((a, b) => b.Ecopoints - a.Ecopoints);

  let html = "";

  users.forEach((user, index) => {
    html += `
      <tr>
        <td data-label="Rank">${index + 1}</td>
        <td data-label="RFID UID">${user.uid}</td>
        <td data-label="Name">${user.name}</td>
        <td data-label="City">${user.city}</td>
        <td data-label="Total Waste">${user.TotalWeight.toFixed(2)}</td>
        <td data-label="EcoPoints">${user.Ecopoints.toFixed(2)}</td>
      </tr>
    `;
  });

  document.getElementById("users").innerHTML =
    html || "<tr><td colspan='6'>No users found</td></tr>";
});
</script>

</body>
</html>
