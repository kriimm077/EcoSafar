<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoSafar • Admin Dashboard</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  font-family:Arial, sans-serif;
  background:#eef9f1;
  padding:20px;
}
h2{
  color:#145A13;
  margin-bottom:20px;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  padding:10px;
  border:1px solid #ccc;
  text-align:center;
}
th{
  background:#dff3ea;
  color:#145A13;
}
tr:nth-child(even){
  background:#f5fbf7;
}
</style>
</head>

<body>

<h2>EcoSafar – Admin Dashboard</h2>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>RFID UID</th>
      <th>Name</th>
      <th>City</th>
      <th>Total Waste (g)</th>
      <th>EcoPoints</th>
    </tr>
  </thead>
  <tbody id="users"></tbody>
</table>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com/",
  projectId: "ecosafar-b8e9b"
});

const db = firebase.database();

/* READ ROOT USERS */
db.ref("/").on("value", snap => {

  let users = [];

  snap.forEach(child => {
    const uid = child.key;
    const d = child.val();

    // Ignore invalid nodes
    if(!d || !d.name) return;

    users.push({
      uid: uid,
      name: d.name || "-",
      city: d.city || "-",
      weight: Number(d.TotalWeight) || 0,
      points: Number(d.Ecopoints) || 0
    });
  });

  // Sort by EcoPoints DESC
  users.sort((a,b) => b.points - a.points);

  let html = "";

  users.forEach((u,i)=>{
    html += `
      <tr>
        <td>${i+1}</td>
        <td>${u.uid}</td>
        <td>${u.name}</td>
        <td>${u.city}</td>
        <td>${u.weight.toFixed(2)}</td>
        <td>${u.points.toFixed(2)}</td>
      </tr>
    `;
  });

  document.getElementById("users").innerHTML =
    html || "<tr><td colspan='6'>No users found</td></tr>";
});
</script>

</body>
</html>
