<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoSafar ‚Ä¢ Admin Dashboard</title>


<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0faf5;
  margin: 0;
  padding: 30px 20px;
  color: #145A13;
  text-align: center;
}

#logo {
  width: 100px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}

h2 {
  font-size: 28px;
  margin-bottom: 20px;
}


#alertBox {
  display: none;
  max-width: 420px;
  margin: 0 auto 20px;
  background: #fee2e2;
  color: #991b1b;
  padding: 14px;
  border-radius: 10px;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.bin-card {
  max-width: 420px;
  margin: 0 auto 30px;
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.bin-title {
  font-weight: 600;
  margin-bottom: 15px;
}

.bin-row {
  display: flex;
  justify-content: space-between;
  margin: 10px 0;
}

.progress {
  width: 100%;
  height: 16px;
  background: #e5f3ea;
  border-radius: 8px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #22c55e, #15803d);
  transition: width 0.5s ease;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: #ffffff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

th, td {
  padding: 14px;
  text-align: center;
}

th {
  background: #dff3ea;
  text-transform: uppercase;
  font-size: 14px;
}

tr:nth-child(even) td {
  background: #f7fcf8;
}

@media (max-width: 768px) {
  table, thead, tbody, th, td, tr { display: block; }
  thead { display: none; }
  tr {
    margin-bottom: 15px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    border-radius: 8px;
  }
  td {
    text-align: right;
    padding-left: 50%;
    position: relative;
  }
  td::before {
    content: attr(data-label);
    position: absolute;
    left: 15px;
    font-weight: 600;
  }
}
</style>
</head>

<body>

<img src="logo.png" id="logo" alt="EcoSafar Logo">
<h2>EcoSafar ‚Äì Admin Dashboard</h2>


<div id="alertBox">‚ö†Ô∏è BIN001 IS FULL ‚Äì COLLECTION REQUIRED</div>

<div class="bin-card">
  <div class="bin-title">üóëÔ∏è BIN001 Status</div>

  <div class="bin-row">
    <span>Distance</span>
    <strong><span id="distance">--</span> cm</strong>
  </div>

  <div class="bin-row">
    <span>Fill Level</span>
    <strong><span id="fill">--</span> %</strong>
  </div>

  <div class="progress">
    <div class="progress-bar" id="fillBar"></div>
  </div>

  <div class="bin-row" style="font-size:14px;margin-top:10px;">
    <span>Last Updated</span>
    <span id="lastUpdated">--</span>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>RFID UID</th>
      <th>Name</th>
      <th>City</th>
      <th>Total Waste (g)</th>
      <th>EcoPoints</th>
    </tr>
  </thead>
  <tbody id="users">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBK72ROuOs4fDc5p5CFaHSWwW8oQZwEL-g",
  databaseURL: "https://ecosafar-b8e9b-default-rtdb.firebaseio.com"
});

const db = firebase.database();


db.ref("admins/Anand/bins/BIN001").on("value", snap => {
  const d = snap.val();
  if (!d) return;

  document.getElementById("distance").innerText = d.distanceCM;
  document.getElementById("fill").innerText = d.fillPercentage;
  document.getElementById("fillBar").style.width = d.fillPercentage + "%";


  if (d.lastUpdated) {
    const ts = d.lastUpdated < 1000000000000
      ? d.lastUpdated * 1000
      : d.lastUpdated;
    document.getElementById("lastUpdated").innerText =
      new Date(ts).toLocaleString();
  }


  if (d.fillPercentage >= 90) {
    document.getElementById("alertBox").style.display = "block";
  } else {
    document.getElementById("alertBox").style.display = "none";
  }
});
db.ref("users").on("value", snapshot => {
  let users = [];

  snapshot.forEach(child => {
    const data = child.val();
    if (!data || !data.name) return;

    users.push({
      uid: child.key,
      name: data.name,
      city: data.city || "-",
      TotalWeight: Number(data.TotalWeight || 0),
      Ecopoints: Number(data.Ecopoints || 0)
    });
  });

  users.sort((a,b) => b.Ecopoints - a.Ecopoints);

  document.getElementById("users").innerHTML = users.map((u,i)=>`
    <tr>
      <td data-label="Rank">${i+1}</td>
      <td data-label="RFID UID">${u.uid}</td>
      <td data-label="Name">${u.name}</td>
      <td data-label="City">${u.city}</td>
      <td data-label="Total Waste">${u.TotalWeight.toFixed(2)}</td>
      <td data-label="EcoPoints">${u.Ecopoints.toFixed(2)}</td>
    </tr>
  `).join("") || "<tr><td colspan='6'>No users</td></tr>";
});
</script>

</body>
</html>
