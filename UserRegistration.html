<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoSafar • User Registration</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
    --primary: #145A13;
    --accent: #2ecc71;
    --bg: #eef9f1;
    --text-muted: #5f6f66;
}
* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
body { background: linear-gradient(135deg,#e8f6ef,#dff3ea); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
.card { background:#fff; width:420px; padding:50px 35px; border-radius:24px; box-shadow:0 25px 60px rgba(0,0,0,0.12); text-align:center; }
.logo { width:120px; height:120px; margin:0 auto 20px; display:block; border-radius:16px; object-fit:contain; animation: logo-pulse 2s infinite ease-in-out, logo-float 3s infinite ease-in-out; }
@keyframes logo-pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.1);} }
@keyframes logo-float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
h2 { color: var(--primary); font-size:28px; margin-bottom:6px; }
.subtitle { font-size:14px; color:var(--text-muted); margin-bottom:28px; }
label { font-weight:600; margin-bottom:6px; display:block; text-align:left; color:#2f3e36; }
input, select { width:100%; padding:14px 16px; border-radius:12px; border:1px solid #cfded5; margin-bottom:18px; font-size:15px; }
input:focus, select:focus { outline:none; border-color: var(--accent); box-shadow:0 0 6px rgba(46,204,113,0.35); }
button { width:100%; padding:15px; border:none; border-radius:16px; background: var(--primary); color:#fff; font-size:16px; font-weight:600; cursor:pointer; margin-bottom:12px; }
button:hover { background:#1a7a1f; }
.login-btn { background: var(--accent); color:#0b3d0f; }
.login-btn:hover { background:#28b463; }
.msg { margin-top:18px; font-weight:600; font-size:14px; }
.error { color:#c40000; }
.success { color: var(--primary); }
</style>
</head>

<body>

<div class="card">
    <img src="logo.png" alt="EcoSafar Logo" class="logo">
    <h2>User Registration</h2>
    <p class="subtitle">Create your EcoSafar account</p>

    <label for="name">Full Name</label>
    <input id="name" placeholder="Enter full name">

    <label for="city">City</label>
    <select id="city">
        <option value="">Select City</option>
        <option>Anand</option>
        <option>Ahmedabad</option>
        <option>Surat</option>
    </select>

    <label for="uid">RFID UID</label>
    <input id="uid" placeholder="Scan or enter UID (e.g. BF604DEE)">

    <label for="password">Password</label>
    <input id="password" type="password" placeholder="Create password">

    <button onclick="registerUser()">Register</button>
    <button class="login-btn" onclick="goLogin()">Already have an account? Login</button>

    <div id="msg" class="msg"></div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyC-ukbAaOdiEb65v9F7FuBzT0TTRoQHyxw",
  databaseURL: "https://ecosafar-3da96-default-rtdb.firebaseio.com",
  projectId: "ecosafar-3da96"
});

const db = firebase.database();

function registerUser(){
    const name = document.getElementById("name").value.trim();
    const city = document.getElementById("city").value;
    const uid = document.getElementById("uid").value.trim().toUpperCase();
    const password = document.getElementById("password").value.trim();
    const msg = document.getElementById("msg");

    msg.innerHTML = "";

    if(!name || !city || !uid || !password){
        msg.innerHTML = "<span class='error'>All fields are required</span>";
        return;
    }

    if(!/^[A-Z0-9]+$/.test(uid)){
        msg.innerHTML = "<span class='error'>Invalid RFID UID</span>";
        return;
    }

    const userRef = db.ref(`users/${uid}`);

    userRef.once("value").then(snapshot=>{
        if(snapshot.exists()){
            msg.innerHTML = "<span class='error'>RFID already registered</span>";
            return;
        }

        userRef.set({
            name: name,
            city: city,
            password: password,
            Ecopoints: 0,
            TotalWeight: 0,
            createdAt: new Date().toISOString()
        }).then(()=>{
            msg.innerHTML = "<span class='success'>Registration successful ✔</span>";
            setTimeout(()=>{
                window.location.href = "UserLogin.html";
            },1500);
        }).catch(err=>{
            msg.innerHTML = "<span class='error'>"+err.message+"</span>";
        });
    }).catch(err=>{
        msg.innerHTML = "<span class='error'>"+err.message+"</span>";
    });
}

function goLogin(){
    window.location.href = "UserLogin.html";
}
</script>

</body>
</html>
